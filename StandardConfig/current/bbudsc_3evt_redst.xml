<!--
      Example steering file to re-DST the 3 ttbar events 
      reconstruction with standard DBD reconstruction.

      Works with ilcsoft v01-17-08

-->


 <marlin>
   
   <execute>
     <processor name="MyAIDAProcessor"/>
         
     <!-- ========== RecoMCTruthLinker   ================= -->
     <processor name="MyRecoMCTruthLinker"/>
     
     <!-- ========== dE/dx   ================= -->
     <processor name="MyCompute_dEdxProcessor"/>  

     <!-- ========== covanriance matrix for charged PFOs  ======= -->
     <processor name="MyAdd4MomCovMatrixCharged"/>

     <!-- ========== Shower Profiles   ================= -->
     <processor name="MyComputeShowerShapesProcessor"/>    

     <!-- ========== particle ID ============================ -->
     <processor name="MyLikelihoodPID" />

     <processor name="DSTOutput"/>
   </execute>

   <global>
      <parameter name="LCIOInputFiles">
        /pnfs/desy.de/ilc/prod/ilc/mc-dbd/ild/rec/500-TDR_ws/aa_4f/ILD_o1_v05/v01-16-p05_500/rv01-16-p05_500.sv01-14-01-p00.mILD_o1_v05.E500-TDR_ws.I37417.Paa_xxyy.eW.pW-00001-REC.slcio      </parameter>
      <parameter name="GearXMLFile" value="GearOutput.xml"/>
      <parameter name="MaxRecordNumber" value="2"/>
      <parameter name="SkipNEvents" value="0"/>
      <parameter name="SupressCheck" value="false"/>
      <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> MESSAGE </parameter>
      <parameter name="RandomSeed" value="1234567890" />
      <parameter name="AllowToModifyEvent" value="true" />
   </global>

 <processor name="DSTOutput" type="LCIOOutputProcessor">
   <!--   
     DST output: drop all hits, skim MCParticles and keep final Tracks, Clusters, Vertices and  ReconstructedParticles 
   -->
   <parameter name="LCIOOutputFile" type="string" >
     example_reDST.slcio
   </parameter>
    <!-- collections of these types will be dropped, unless specified below -->
   <parameter name="DropCollectionTypes" type="StringVec">  
       MCParticle
       SimTrackerHit 
       SimCalorimeterHit
       TrackerHit 
       TrackerHitPlane 
       CalorimeterHit 
       LCRelation
       Track 
       LCFloatVec      
    </parameter>
    <!-- IMPORTANT: adjust to MCParticle collection name which should be kept! -->
    <parameter name="FullSubsetCollections" type="StringVec" value="MCParticlesSkimmedNew"/>
    <!-- collections of the above types to keep -->
    <parameter name="KeepCollectionNames" type="StringVec"> 
      MCParticlesSkimmedNew 
      MarlinTrkTracks
      MCTruthMarlinTrkTracksLink
      MarlinTrkTracksMCTruthLink
      MCTruthClusterLink
      ClusterMCTruthLink
      RecoMCTruthLinkNew
      MCTruthRecoLink
    </parameter>
    <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
    <!--parameter name="SplitFileSizekB" type="int" value="1992294"/-->
 </processor>
 
 <processor name="MyAIDAProcessor" type="AIDAProcessor">
 <!--Processor that handles AIDA files. Creates on directory per processor.  Processors only need to create and fill the histograms, clouds and tuples. Needs to be the first ActiveProcessor-->
  <!-- compression of output file 0: false >0: true (default) -->
  <parameter name="Compress" type="int" value="1"/>
  <!-- filename without extension-->
  <parameter name="FileName" type="string" value="bbudsc_3evt_stdreco"/>
  <!-- type of output file xml (default) or root ( only OpenScientist)-->
  <parameter name="FileType" type="string" value="root "/>
</processor>

<!-- ############ RecoMCTruthLink ############# -->
 <processor name="MyRecoMCTruthLinker" type="RecoMCTruthLinker">
   <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> MESSAGE  </parameter> 

   <!--  Input collections: mcparticles, pfos, clusters and tracks 
         PFOs already connect to tracks and clusters, so what we do in this processor is to connect
         tracks and clusters to mcparticles ... 
         The values given here are the defaults, so they don't really need to be
         specified -->
   <parameter name="MCParticleCollection" type="string" lcioInType="MCParticle"> 
         MCParticle 
   </parameter>
   <!-- (Default of these two ar PandoraPFOs and PandoraClusters. Use the one below to fix the 
         BCal problem. Clearly NoPandoraBcal must have been run before for them to exists ! ) -->
   <parameter name="RecoParticleCollection" type="string" lcioInType="ReconstructedParticle">
         PandoraPFOs
   </parameter>
   <parameter name="ClusterCollection" type="string" lcioInType="Cluster"> 
         PandoraClusters
   </parameter>

   <parameter name="TrackCollection" type="string" lcioInType="Track"> 
         MarlinTrkTracks 
   </parameter>


   <!-- Don't change any of these hit related collections if you're not very sure you know what you are doing.
        In any case, the ones listed here are the defaults, so they can be removed from
        this steering -->
   <!--  Simulated tracker hits (has the conection to MCParticles -->
   <parameter name="SimTrackerHitCollections" type="StringVec" lcioInType="SimTrackerHit">
         VXDCollection 
         SITCollection 
         FTD_PIXELCollection 
         FTD_STRIPCollection 
         TPCCollection 
         SETCollection  
  </parameter>
  <!--  Connections from tracker hits (connected to tracks) to sim tracker hits (connects to MC particle) -->
  <parameter name="TrackerHitsRelInputCollections" type="StringVec" lcioInType="LCRelation">
         VXDTrackerHitRelations 
         SITSpacePointRelations
         FTDSpacePointRelations
         FTDPixelTrackerHitRelations 
         TPCTrackerHitRelations 
         SETSpacePointRelations 
</parameter>
 <!-- same for the calos: Simulated calo hits (has the connection to MCParticles) -->
 <parameter name="SimCaloHitCollections" type="StringVec" lcioInType="SimCalorimeterHit">
         BeamCalCollection
         EcalBarrelSiliconCollection
         EcalBarrelSiliconPreShowerCollection
         EcalEndcapRingCollection
         EcalEndcapRingPreShowerCollection
         EcalEndcapSiliconCollection
         EcalEndcapSiliconPreShowerCollection
         HcalBarrelRegCollection
         HcalEndCapRingsCollection
         HcalEndCapsCollection
         LHcalCollection
         LumiCalCollection
         MuonBarrelCollection
         MuonEndCapCollection
  </parameter> 
  <!-- Connections from calo hist (connected to clusters) tp sim calo hits  (connects to MC particle) -->
  <parameter name="SimCalorimeterHitRelationNames" type="StringVec" lcioInType="LCRelation">
         RelationCaloHit
         RelationLHcalHit
         RelationMuonHit
         <!-- missing in DBD files --> 
         <!-- RelationLcalHit
         RelationBCalHit -->
          -->
  </parameter> 

  <!--PDG codes of particles of which the daughters will be kept in the skimmmed MCParticle collection-->
  <parameter name="KeepDaughtersPDG" type="IntVec"> 
         22 111 310 13 211 321
  </parameter>


  <!--Names of the output collections -->


  <!-- reduced MCParticle collection. Default is MCParticlesSkimmed, but that clashes
       with the name already on the input RECO-file -->
  <parameter name="MCParticlesSkimmedName" type="string" lcioOutType="MCParticle"> 
         MCParticlesSkimmedNew 
  </parameter>
  <!-- links between tracks or clusters and mcparticles. The two sets differ
       in what the weight means. These four will only be output if the
       name is given here in the steering -->
  <parameter name="MCTruthTrackLinkName" type="string" lcioOutType="LCRelation"> 
         MCTruthTrackLink 
  </parameter>
  <parameter name="TrackMCTruthLinkName" type="string" lcioOutType="LCRelation"> 
         TrackMCTruthLink 
  </parameter>
  <parameter name="ClusterMCTruthLinkName" type="string" lcioOutType="LCRelation"> 
         ClusterMCTruthLink 
  </parameter>
  <parameter name="MCTruthClusterLinkName" type="string" lcioOutType="LCRelation"> 
         MCTruthClusterLink 
  </parameter>

  <!-- Link between seen calorimeter hits (connected to clusters) and MCParticles. 
       Also only output if the name is given here -->
  <parameter name="CalohitMCTruthLinkName" type="string" lcioOutType="LCRelation"> 
         CalohitMCTruthLink 
  </parameter>

  <!-- Links PFO <-> MCParticles. Only RecoMCTruthLink is output by default,
       to also get the reverse link, MCTruthRecoLinkName must be given here -->
  <!-- Also here, the default (RecoMCTruthLink) needs to be changed to avoid clashes  with
       the input -->
  <parameter name="RecoMCTruthLinkName" type="string" lcioOutType="LCRelation"> 
         RecoMCTruthLinkNew 
  </parameter>
  <parameter name="MCTruthRecoLinkName" type="string" lcioOutType="LCRelation"> 
         MCTruthRecoLink 
  </parameter>
  <!-- set to true to get the weights in RecoMCTruthLink to include both weights to
       tracks and clusters. False implies that only the true particle that
       gives most contributions to the track of the PFO (charged PFOs), or
       to the cluster (neutral ones) is linked to the PFO -->
  <parameter name="FullRecoRelation" type="bool"> true </parameter>
</processor>


<!-- ############ dedx calculation processor ############# -->

<processor name="MyCompute_dEdxProcessor" type="Compute_dEdxProcessor">
  <!--Energy Loss Error for TPC-->
  <parameter name="EnergyLossErrorTPC" type="float">0.05 </parameter>
  <!--LDC Track collectoin name-->
  <parameter name="LDCTrackCollection" type="string"> MarlinTrkTracks </parameter>
</processor>


<!--################   MyPfoAnalysis  ################################ -->

<processor name="MyPfoAnalysis" type="PfoAnalysis">
  <!--PfoAnalysis analyses output of PandoraPFANew-->
  <!--Names of input pfo collection-->
  <parameter name="PfoCollection" type="string" lcioInType="ReconstructedParticle">PandoraPFOs </parameter>
  <!--Names of mc particle collection-->
  <parameter name="MCParticleCollection" type="string" lcioInType="MCParticle">MCParticleSkimmedNew </parameter>
  <!--Set the debug print level-->
  <parameter name="Printing" type="int">0 </parameter>
  <!--Name of the output root file-->
  <parameter name="RootFile" type="string"> PfoAnalysis.root  </parameter>
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string">DEBUG </parameter-->
</processor>

<!--########## Add4MomCovMatrixCharged ###################################### -->

<!--Set the convariance matrix in (P,E) for all charged pfos in PandoraPFOs Collection-->
<processor name="MyAdd4MomCovMatrixCharged" type="Add4MomCovMatrixCharged">
  <!-- Name of the PandoraPFOs collection   --> 
  <parameter name="InputPandoraPFOsCollection" type="String">PandoraPFOs</parameter>
  <!--Verbosity lower than MESSAGE4 will print out cov. matrix for each pfo-->
  <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> MESSAGE4 </parameter>
</processor>

<!--################################################ -->


 <processor name="MyComputeShowerShapesProcessor" type="ComputeShowerShapesProcessor">
  <!--Performs Shower profile extraction-->
  <!--Debugging?-->
  <parameter name="Debug" type="int">0 </parameter>
  <!--Name of the PFO collection-->
  <parameter name="PFOCollection" type="string"> PandoraPFOs </parameter>
  <!--Name of the Cluster collection-->
  <parameter name="ClusterCollectionName" type="string"> PandoraClusters </parameter>
  <!-- Radiation Length of Ecal-->
  <parameter name="RadiationLength_Ecal" type="float">3.50 </parameter>
  <!-- Radiation Length of Hcal-->
  <parameter name="RadiationLength_Hcal" type="float">17.57 </parameter>
  <!-- Moliere radius of Ecal-->
  <parameter name="MoliereRadius_Ecal" type="float">9.00 </parameter>
  <!-- Moliere radius of Hcal-->
  <parameter name="MoliereRadius_Hcal" type="float">17.19 </parameter>
  </processor>

<!--################################################ -->

 <processor name="MyLikelihoodPID" type="LikelihoodPIDProcessor">
  <!--Performs particle identification-->
  <!--Debugging?-->
  <parameter name="Debug" type="int">1 </parameter>
  <!--Boundaries for energy binning-->
  <parameter name="EnergyBoundaries" type="FloatVec">0 1.0e+07  </parameter>
  <!--Name of files containing pdfs for charged particles-->
  <parameter name="FilePDFName" type="StringVec">
    LikelihoodPID_Histogram_v01.root
  </parameter>
 <parameter name="FileWeightFormupiSeparationName" type="StringVec">
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_02GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_03GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_04GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_05GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_06GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_07GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_08GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_09GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_10GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_11GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_12GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_13GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_14GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_15GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_16GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_17GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_18GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_19GeVP_clusterinfo.weights.xml
 ./weightFiles_forLowMomentumMuPiSeparation/TMVAClassification_BDTG_20GeVP_clusterinfo.weights.xml
  </parameter>
  <!--Name of the PFO collection-->
  <parameter name="RecoParticleCollection" type="string">PandoraPFOs</parameter>
 </processor>

<!--################################################ -->




  
</marlin>
