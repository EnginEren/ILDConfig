###################################################
#
# HOWTO run lcgeo and Marlin examples
# with standard configuration
# 
# F.Gaede, DESY/CERN
#   06/2015  F.G:  updated to use lcgeo/ddsim
#   12/2011: F.G.: updated to new ILD_01_dev model 
#   06/2012: J.E.: updated to new ILD_o{1,2,3}_v01 models
###################################################

#  These little examples server as an ultra quick introduction on 
#  how to run ilcsoft programs and as a mini-test after installation
#  of a new (complete) ilcsoft release.
#

#===============================================================================================
# 1. ----  initialize the current ilcsoft release, e.g.  ------

  source /afs/desy.de/project/ilcsoft/sw/x86_64_gcc44_sl6/v01-17-09/init_ilcsoft.sh


#===============================================================================================
# 2. ---- run the lcgeo/ddsim simulation example  ------

    ddsim --inputFiles ./bbudsc_3evt.stdhep --outputFile=./bbudsc_3evt.slcio --compactFile $lcgeo_DIR/ILD/compact/ILD_o1_v05/ILD_o1_v05.xml --steeringFile=./ddsim_steer.py


#===============================================================================================
#--   this creates the file:    bbudsc_3evt.slcio

  #- example: examine the collections in the file:

  anajob bbudsc_3evt.slcio

 
#===============================================================================================
# 3. ----- create a gear file for the model ----------------

  convertToGear default $lcgeo_DIR/ILD/compact/ILD_o1_v05/ILD_o1_v05.xml gear_ILD_o1_v05_dd4hep.xml

  This creates a gear file for the ILD model and is currently still needed when running with 
  DD4hep/lcgeo as some processors have not yet been updated


#===============================================================================================
# 4. ----  reconstruct these events:  ------

  Marlin bbudsc_3evt_stdreco_dd4hep.xml --InitDD4hep.DD4hepXMLFile=$lcgeo_DIR/ILD/compact/ILD_o1_v05/ILD_o1_v05.xml

#-- creates:   bbudsc_3evt_REC.slcio 
#   and        bbudsc_3evt_DST.slcio

#- example: dump the details of the 2nd event in the DST file: 

   dumpevent bbudsc_3evt_DST.slcio 2 | less


#===============================================================================================
# 4.1 ---- alternative reconstruction steering files: ------
# -- they substitute std silicon tracking with new algorithms --
# -- Attention! still experimental --

  Marlin bbudsc_3evt_stdreco.xml
# -- run the old reconstruction code using the gear file created above

  Marlin FPCCDTracker_stdreco.xml
# -- Adding Marlin steering file which runs the FPCCD tracking algorithm --
# -- Experimental - not yet fully validated --

  Marlin minivector_reco.xml
# -- Adding a reconstruction file which uses a mini-vector algorithm, based on cellular automaton tools, --
# -- for pattern recognition at the VXD-SIT --
# -- still experimental - not fully validated --
# -- According to the examined VXD design, the user should set the proper time resolution for pair bkg overlay --
# -- and correct accordingly for spatial resolution at the VXDPlanarDigiProcessor --


#===============================================================================================
# 5. ---- view the result in the event display
 
# a) 
#--- start the event display (server) first: 
  
   glced &

#--- view rec or DST events:

   Marlin bbudsc_3evt_viewer.xml

   Marlin bbudsc_3evt_viewerDST.xml

# b)  
#--  or start both, glced and Marlin in one go:

 ced2go   -d gear_ILD_o1_v05_dd4hep.xml  bbudsc_3evt_REC.slcio

# c) 
# -- or start CED with DD4hep geometry: displaying tracking surfaces
#  note: a slightly simplified model is used to reduce startup time
ced2go -s 1 -d $lcgeo_DIR/ILD/compact/Simplified_ILD_o1_v05/Simplified_ILD_o1_v05.xml bbudsc_3evt_REC.slcio

#===============================================================================================
# 6.  ----- create a ROOT TTree with an n-tuple

  Marlin lctuple.xml

#-- creates: bbudsc_3evt_REC_lctuple.root
#  which you can analyze with ROOT in the usual way
#  or run some examples:
# root [0] .x ./draw_simhits.C("bbudsc_3evt_REC_lctuple.root")
# root [1] .x ./draw_etot.C("bbudsc_3evt_REC_lctuple.root")

#===============================================================================================
#===============================================================================================
