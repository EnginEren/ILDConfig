#############################################################
# tools to setup a local mysql database and run mokka
# with the local database
#
# Jan Engels, DESY - IT
# $Id: README 1985 2012-01-20 09:52:53Z engels $
#############################################################

--- how to update the Mokka DB dump in this package ---------

# 1. check which is the most up to date Mokka tag (e.g. mokka-08-00)
export newmokkaver=mokka-08-00
export oldmokkaver=mokka-07-07-p11
# 2. run ./scripts/mokkadump.sh
test -e $newmokkaver-dbdump.sql || ./scripts/mokkadump.sh $newmokkaver-dbdump.sql
# 3. compress sql file
tar czf $newmokkaver-dbdump.sql.tgz $newmokkaver-dbdump.sql
# 4. update symbolic link
rm mokka-dbdump.sql.tgz
ln -s $newmokkaver-dbdump.sql.tgz mokka-dbdump.sql.tgz
# 5. add the new dump to svn
svn add $newmokkaver-dbdump.sql.tgz
# 6. remove the old dump from svn
svn rm $oldmokkaver-dbdump.sql.tgz
# 7. commit changes to svn
svn ci -m"added new mokka dump: $newmokkaver-dbdump.sql.tgz ($(date "+%F - %T"))"


--- quick steps to run Mokka with a local dump --------------

# if your OS has mysql-server installed you can skip step 1.

#----- step 1 -----
#
# set MYSQL_HOME to a local installation of mysql, e.g.:
export MYSQL_HOME=/afs/desy.de/i586_rhel40/products/mysql/5.0.45/

# if you don;t have one, get it from the web
wget http://downloads.mysql.com/archives/mysql-5.0/mysql-5.0.45-linux-i686.tar.gz
tar xzf mysql*.tar.gz
export MYSQL_HOME=$PWD/mysql-*


#----- step 2 -----

# MOKKA_DUMP_FILE should point to a valid mokka dump file
# ( tarballs with .tgz or .tar.gz extension are also valid )
export MOKKA_DUMP_FILE=$PWD/mokka-dbdump.sql.tgz

#----- step 3 -----
# call mokka wrapper with the usual Mokka options
./scripts/mokka-wrapper.sh gunScan.steer



--- notes ---------------------------------------------------

# you can choose where the local mokka database should be
# installed by setting MOKKA_TMP_DIR, e.g.
export MOKKA_TMP_DIR=/scratch/$USER/tmp/mokka-$(date +%F--%H-%M-%S)

# MOKKA_INIT_DB_SETUP_FILE can be used to load a setup sql
# script after importing the dump, e.g. to grant privileges
export MOKKA_INIT_DB_SETUP_FILE=$PWD/mokka_init_privileges.sql

# for more info on the mysql-setup script you can run:
./scripts/mysql-local-db-setup.sh -h

# set MSG_LOG_FILE to define where the log file should be written:
export MSG_LOG_FILE=/tmp/$USER-last-mokka-run.log

# set MSG_LOG_LEVEL to set the level of verbosity (DEBUG, INFO, WARNING, ERROR):
export MSG_LOG_LEVEL=DEBUG

